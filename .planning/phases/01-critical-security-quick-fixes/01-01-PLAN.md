---
phase: 01-critical-security-quick-fixes
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - lib/fireStoreRef.js
  - lib/env.ts
  - components/Footer.tsx
autonomous: true

must_haves:
  truths:
    - "Firebase credentials are not visible in source code"
    - "Application gracefully handles missing environment variables"
    - "External links do not expose window.opener to target sites"
  artifacts:
    - path: "lib/fireStoreRef.js"
      provides: "Firebase configuration using environment variables"
      contains: "process.env.NEXT_PUBLIC_"
    - path: "lib/env.ts"
      provides: "Environment variable validation utility"
      exports: ["validateEnv"]
    - path: "components/Footer.tsx"
      provides: "External links with security attributes"
      contains: 'rel="noopener noreferrer"'
  key_links:
    - from: "lib/fireStoreRef.js"
      to: "process.env"
      via: "environment variable access"
      pattern: "process\\.env\\.NEXT_PUBLIC_"
    - from: "components/Footer.tsx"
      to: "external domains"
      via: "Link components with rel attribute"
      pattern: 'rel="noopener noreferrer"'
---

<objective>
Eliminate critical security vulnerability by removing hardcoded Firebase credentials, add environment variable validation with graceful degradation, and secure external links against reverse tabnabbing.

Purpose: Prevent unauthorized access to Firebase services and protect users from external link security risks
Output: Secure configuration loading, validated environment variables, hardened external links
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-critical-security-quick-fixes/01-CONTEXT.md
@lib/fireStoreRef.js
@lib/db.ts
@components/Footer.tsx
</context>

<tasks>

<task type="auto">
  <name>Remove hardcoded Firebase credentials and clean up fireStoreRef.js</name>
  <files>lib/fireStoreRef.js</files>
  <action>
Replace hardcoded Firebase config object (lines 3-11) with environment variable references using `process.env.NEXT_PUBLIC_*` pattern matching the structure in lib/db.ts. Keep same export structure: `export const firebaseConfig = { ... }`.

Remove active Firestore example code (lines 117-125) that reads from "cities" collection - this is leftover example code not used by the app.

Remove all commented-out example code blocks (lines 29-131) - these are Firebase documentation examples serving no purpose in production code.

Keep Firebase imports and initialization (lines 14-25) but ensure they use the updated firebaseConfig that references env vars.

Per user decision: Clean up in place, do NOT delete the file or rename to .ts (Phase 3 handles full TypeScript migration).
  </action>
  <verify>
grep -n "AIzaSyC" lib/fireStoreRef.js should return no results (hardcoded API key removed)
grep -n "process.env.NEXT_PUBLIC_" lib/fireStoreRef.js should show environment variable usage
wc -l lib/fireStoreRef.js should show ~25 lines (down from 131)
  </verify>
  <done>fireStoreRef.js contains no hardcoded credentials, references process.env for all config values, has no commented example code, and is under 30 lines</done>
</task>

<task type="auto">
  <name>Create environment variable validation utility with graceful degradation</name>
  <files>lib/env.ts</files>
  <action>
Create lib/env.ts that validates required environment variables and provides graceful degradation behavior per user decision: "degraded state, not crash".

Export `validateEnv()` function that checks for presence of:
- NEXT_PUBLIC_FIREBASE_API_KEY
- NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN
- NEXT_PUBLIC_FIREBASE_PROJECT_ID
- NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET
- NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID
- NEXT_PUBLIC_FIREBASE_APP_ID
- NEXT_PUBLIC_TMDB_API_KEY
- NEXT_PUBLIC_TMDB_COLLECTION_ID

For missing variables: log clear warning to console identifying which variable is missing (e.g., "Warning: NEXT_PUBLIC_TMDB_API_KEY is not set. TMDB service will be unavailable.") but do NOT throw errors or crash.

Return validation result object: `{ valid: boolean, missing: string[] }` so calling code can decide how to handle degraded state.

Add JSDoc comments documenting the graceful degradation approach.
  </action>
  <verify>
cat lib/env.ts confirms file exists with validateEnv export
grep -c "console.warn" lib/env.ts should show warning logging for missing vars
npm run build should succeed even with missing env vars (no crash)
  </verify>
  <done>lib/env.ts exists, exports validateEnv function, logs warnings for missing variables, returns validation status, and does not crash on missing vars</done>
</task>

<task type="auto">
  <name>Add rel="noopener noreferrer" to all external links in Footer</name>
  <files>components/Footer.tsx</files>
  <action>
Add `rel="noopener noreferrer"` attribute to all 6 external Link components in Footer.tsx:
- Line 10-15: icons8.com icon link
- Line 18-24: icons8.com main link
- Line 28-33: TMDB API documentation link
- Line 36-41: TMDB main site link
- Line 44-50: GitHub CodeWarrior-debug profile link
- Line 52-58: GitHub repository link

This prevents reverse tabnabbing attacks by ensuring target sites cannot access window.opener object.

Use Next.js Link component's rel prop: `<Link target="_blank" rel="noopener noreferrer" href="...">`.
  </action>
  <verify>
grep -c 'rel="noopener noreferrer"' components/Footer.tsx should return 6 (one for each external link)
grep -c 'target="_blank"' components/Footer.tsx should match (every target="_blank" has rel attribute)
  </verify>
  <done>All external links in Footer.tsx include rel="noopener noreferrer" attribute alongside target="_blank"</done>
</task>

</tasks>

<verification>
Run security checks:
- `grep -r "AIzaSyC" lib/` returns no matches (no hardcoded credentials)
- `grep -r 'target="_blank"' components/Footer.tsx` shows all have rel="noopener noreferrer"
- `npm run build` succeeds with or without env vars set
- Console shows clear warnings if env vars missing
</verification>

<success_criteria>
- Firebase credentials removed from source code and loaded from environment variables
- Environment variable validation exists with graceful degradation (warning, not crash)
- All external links include security attributes preventing reverse tabnabbing
- Application builds successfully in both configured and unconfigured states
- No breaking changes to existing functionality
</success_criteria>

<output>
After completion, create `.planning/phases/01-critical-security-quick-fixes/01-01-SUMMARY.md`
</output>
